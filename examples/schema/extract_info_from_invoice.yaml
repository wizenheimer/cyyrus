spec: v0 # Version of the schema

# Define the properties of the dataset
dataset:
  # Define the metadata of the dataset
  metadata:
    name: Invoice Dataset
    description: Dataset containing the invoice data
    tags: [invoice, financial, document]
    license: CC-BY-NC-SA
    languages: [en]

  # Define how to shuffle the dataset
  shuffle:
    seed: 42

  # Define the splits of the dataset
  splits:
    train: 0.8
    test: 0.2
    seed: 42

  # Define the attributes of the dataset
  attributes:
    required_columns: [invoice_items, customer_info]
    unique_columns: []
    flatten_columns: [invoice_items, invoice_qna]
    exclude_columns: [parsed_invoice]
    nulls: include

# Define the types that will be used in the dataset
types:
  # Define the invoice items
  invoice_items:
    type: array
    items:
      type: object
      properties:
        item:
          type: string
        description:
          type: string
        amount:
          type: float

  # Define the customer info
  customer_info:
    type: object
    properties:
      customer_name:
        type: string
      customer_address:
        type: string
      invoice_id:
        type: string
      total_amount:
        type: float

  # Define the invoice questions
  invoice_qna:
    type: array
    items:
      type: object
      properties:
        question:
          type: string
        answer:
          type: string

# Define the tasks that will be used in Dataset generation, and their properties
tasks:
  # Define the invoice parsing task
  invoice_parsing:
    task_type: parsing
    task_properties:
      directory: experimental/sample/invoice
      file_type: pdf
      max_depth: 5
      parsed_format: base64

  # Define the customer info extraction task
  extract_customer_info:
    task_type: generation
    task_properties:
      model: gpt-4o-mini
      prompt: Extract customer info from the given invoice
      response_format: customer_info
      api_key: $OPENAI_API_KEY

  # Define the invoice items extraction task
  extract_invoice_items:
    task_type: generation
    task_properties:
      model: gpt-4o-mini
      prompt: Extract invoice items from the given table
      response_format: invoice_items
      api_key: $OPENAI_API_KEY

  # Define the invoice qna creation task
  create_invoice_qna:
    task_type: generation
    task_properties:
      model: gpt-4o-mini
      prompt: Create questions and answers about the given invoice
      response_format: invoice_qna
      api_key: $OPENAI_API_KEY

# Define the columns that will be used in the dataset
columns:
  # Define the parsed invoice column
  parsed_invoice:
    task_id: invoice_parsing

  # Define the customer info column
  customer_info:
    task_id: extract_customer_info
    task_input: [parsed_invoice]

  # Define the invoice items column
  invoice_items:
    task_id: extract_invoice_items
    task_input: [parsed_invoice]

  # Define the invoice qna column
  invoice_qna:
    task_id: create_invoice_qna
    task_input: [invoice_items, customer_info]
